Two dynamic regimes in the human gut microbiome

The gut microbiome is a dynamic system that changes with host development, health, behavior, diet, and microbe-microbe interactions. Prior work on gut microbial time series has largely focused on autoregressive models (e.g. Lotka-Volterra). However, we show that most of the variance in microbial time series is non-autoregressive. In addition, we show how community state-clustering is flawed when it comes to characterizing within-host dynamics and that more continuous methods are required. Most organisms exhibited stable, mean-reverting behavior suggestive of fixed carrying capacities and abundant taxa were largely shared across individuals. This mean-reverting behavior allowed us to apply sparse vector autoregression (sVAR)—a multivariate method developed for econometrics—to model the autoregressive component of gut community dynamics. We find a strong phylogenetic signal in the non-autoregressive co-variance from our sVAR model residuals, which suggests niche filtering. We show how changes in diet are also non-autoregressive and that Operational Taxonomic Units strongly correlated with dietary variables have much less of an autoregressive component to their variance, which suggests that diet is a major driver of microbial dynamics. Autoregressive variance appears to be driven by multi-day recovery from frequent facultative anaerobe blooms, which may be driven by fluctuations in luminal redox. Overall, we identify two dynamic regimes within the human gut microbiota: one likely driven by external environmental fluctuations, and the other by internal processes.

Dynamics reveal crucial information about how a system functions. In this study, we develop an approach for disentangling two types of dynamics within the human gut microbiome. We find that autoregressive dynamics involve recovery from large deviations in community structure. These recovery processes appear to involve the blooming of facultative anaerobes and aerotolerant taxa, likely due to transient shifts in redox potential, followed by re-establishment of obligate anaerobes. Non-autoregressive dynamics carry a strong phylogenetic signal, wherein highly related taxa fluctuate coherently. These non-autoregressive dynamics appear to be driven by external, non-autoregressive variables like diet. We find that most of the community variance is driven by day-to-day fluctuations in the environment, with occasional autoregressive dynamics as the system recovers from larger shocks. Despite frequently observed disruptions to the gut ecosystem, there exists a returning force that continually pushes the gut microbiome back towards its steady-state configuration.

Microbial ecology has become an important branch of medical science [1]. Recent work has shown how each person maintains a fairly unique microbial fingerprint [2–4], and that microbial dysbioses are often associated with shifts in health-status [5–8]. We now recognize that our microbiota are highly dynamic, and that these dynamics are linked to ecological resilience and host health [9–11]. The field has not yet settled upon whether gut microbial community structure varies continuously or if it jumps between discrete community states, and whether these states are shared across individuals [12–14]. In particular, some researchers suggest that gut communities can be binned into discrete ‘enterotypes’ [12], while others argue that gut communities vary along multidimensional continua [13]. If the ultimate goal of microbiome research is to improve human health by engineering the ecology of the gut, we must first understand how and why our microbiota vary in time, whether these dynamics are consistent across humans, and whether we can define ‘stable’ or ‘healthy’ dynamics.

Long, dense time series data are becoming increasingly available to microbial ecologists [10, 11, 26]. These temporal data are invaluable for understanding the behavior of microbial communities but require special care during analysis due to the non-independence of temporally adjacent samples [27]. In this paper we conduct a meta-analysis of the four longest, densest human gut time series currently available [10, 11].

We separated microbial dynamics into autoregressive and non-autoregressive components by applying vector autoregressive (VAR) models, which were originally developed for econometrics [28–30]. We took this approach because we found that substantial autocorrelation persisted in most microbial time series for at least 3 days (i.e. past values of an OTU were predictive of its current value), which meant that temporally adjacent samples were not independent. VAR models are standard for analyzing stationary multivariate time series with autocorrelation, cross-correlations, and noise. Time series are considered to be stationary if they appear to be sampled from the same probability distribution through time (i.e. the mean and variance, along with the other moments of the distribution, do not change through time; Fig 1). VARs model each element as a linear function of lagged values of other elements in the time series [29]. In order to reduce the number of coefficients generated by classical VAR models (i.e. with n species in a VAR model with p lags, n2 x p coefficients are generated) and avoid over-fitting we apply regularized estimation, resulting in a sparse VAR (sVAR) [30, 31]. The residual variation of an sVAR model is stripped of much of its autoregressive structure, which allows for the application of standard statistical techniques that assume sample-to-sample independence. sVARs have the benefit of explicitly modeling error, unlike LV-type models [32], and are more straightforward to interpret than CCM forecasting [25].

We suggest that there are two differentiable sets of drivers generating autoregressive and non-autoregressive microbial community dynamics in the gut. The first set of drivers induce multi-day recovery processes, where the past state of the system is predictive of the future state [33]. As mentioned above, LV models are differential equations that can incorporate species-species and species-resource interactions. These models are inherently autoregressive and are the dominant workhorses of ecological time series modeling [19, 26, 34]. The second type of driver is non-autoregressive, and likely includes dietary factors and other external perturbations [10]. In this paper, we show that there are indeed two dynamic regimes: auto-regressive and non-autoregressive. These dynamic regimes appear to reflect internal and external drivers, respectively. The emerging picture of the gut microbiome shows a dynamically stable system, continually buffeted by internal and external forces and recovering back toward a conserved steady-state.

In this section, we directly compare our VAR modeling approach to the more common generalized Lotka Volterra family of models (gLV). gLVs are first-order differential equations that model growth rates as a non-linear function of community composition, and thus assume the existence of mechanistic coupling between variables in the system. VAR models, by contrast, assume linear dynamics, but can only be applied when the observed data are, or have been transformed such that, the time series are stationary. In both gLV and VAR models, dynamics are defined by species-species (or species-resource) interaction terms. In this study, we find that a linear VAR-based approach was sufficient to extract essential dynamics of the system without the need for a nonlinear mechanistic framework (i.e. as implemented in gLV).

Further, VAR(p) models can include an arbitrary number of time lags (i.e. autoregressive processes can extend further back in time). gLVs do not allow for explicit inclusion of historical time series data beyond one time lag. In considering the appropriate approach for analysis of microbial community time series, we created a decision tree to guide appropriate modeling strategies (Fig 2).

Raw 16S (V4-V5) amplicon sequence time series data were obtained from David et al. (2014) [10] and Caporaso et al. (2011) [11]. The four data sets from these two papers are the longest, densest human gut time series currently available. Having long, dense time series is crucial for gaining an understanding of autocorrelation decay timescales and for fitting models to these large multivariate systems. 16S (V3-V5) amplicon data was also obtained from the Human Microbiome Project [1]. Raw data was quality filtered and demultiplexed using Quantitative Insights into Microbial Ecology (QIIME) default settings [35]. In order to compare across studies and reduce technical variance between studies, closed reference Operational Taxonomic Units (OTUs) were clustered at 99% identity against the Greengenes database v. 13_5 [36]. Open reference OTU picking was also run [37], in order to look for non-database OTUs that might contribute substantially to community dynamics. Time series OTU tables (i.e. n x m matrices, with n OTUs and m samples) were normalized by random sub-sampling to contain 10,000 reads per sample. Alpha and beta-diversity metrics (Shannon entropy and Jensen-Shannon divergence) were calculated with custom Python scripts using normalized OTU tables. To reduce noise from sequencing or PCR artifacts in further downstream analyses and to reduce the complexity of our models, only the top 50 most abundant OTUs or the 76 OTUs common across all time series were analyzed. The time series from donors A and B in the David et al. (2014) paper had significant diarrheal events resulting from travel abroad and food poisoning. We wanted to focus on the dynamics of normal, healthy gut communities. Thus, for donor A we focused on days 150–365 (after return from traveling abroad) and for donor B we focused on days 0–150 (prior to food poisoning event). No significant perturbations were reported in the Caporaso et al. (2011) study, so all time points were used in the analysis. 268 HMP samples were sub-sampled to contain 1,000 sequences per sample and OTUs that occurred in fewer than 10 samples were removed.

We included analyses on two non-gut time series from a marine and a freshwater ecosystem. OTU tables and metadata for these studies obtained from the Earth Microbiome Project (EMP) [38]. The EMP study numbers were 1240 (English Channel marine time series) and 1242 (Lake Mendota freshwater time series). The OTU tables and metadata files from these studies can be downloaded from FigShare: https://figshare.com/articles/Time_Series_Meta-Analysis_Files/3581616

Each of our time series data sets had a few gaps (i.e. missing days). These gaps needed to be filled in order to apply our autoregressive modeling approach. Thus, missing data points were filled in using the SciPy [39] implementation of piecewise cubic interpolation (PCHIP). There are many alternative methods for interpolation that can be used (e.g. see SciPy documentation on interpolation methods: http://docs.scipy.org/doc/scipy/reference/interpolate.html) [40], but PCHIP had certain properties that were desired: abundances stay above zero; monotonicity is preserved; does not overshoot when data is not smooth [41].

OTU relative abundance matrices (m time points x n OTUs) were converted into rate matrices (m-1 time points x n OTUs) by subtracting the relative abundance of each OTU at time t from its abundance at time t+1 (i.e. first-differencing). The rate matrix (i.e. the first-difference or first-derivative matrix) shows the dynamics in rates between adjacent time points for each OTU in the data set.

In order to determine whether microbial communities clustered into discrete states (i.e. community configurations that are non-continuously distributed throughout state-space), we fit a Dirichelet multinomial mixture model (DMM) to the data [42]. The DMM clustering null model assumes that the data are pulled from the same Dirichelet multinomial distribution, and increases the number of parent distributions depending on the heterogeneity of the input data. The default Laplace method was used to penalize model complexity (http://bioconductor.org/packages/release/bioc/manuals/DirichletMultinomial/man/DirichletMultinomial.pdf) [42]. We sampled each time series at different levels of temporal resolution (i.e. every time point, every other time point, every third time point, etc.) to determine whether the number of states was influenced by over- or under-sampling of the state space. We restricted the analysis to the top 50 most abundant OTUs within each time series or the 76 abundant OTUs that occurred across all time series.

We looked for organisms that were transiently abundant across the time series by filtering for OTUs with coefficients of bimodality > 0.8 and whose peak abundance was ≥ 10% of the total community [43]. These conditionally rare taxa (CRTs) are rare or undetected across most time points, but occasionally bloom into high-abundance (i.e. ≥ 10% of the community sequence reads).

Autocorrelation decay was determined for each OTU using the autocorrelation function (i.e. acf) in the StatsModels package in Python (http://statsmodels.sourceforge.net/stable/index.html) [44]. Stationarity (i.e. whether a time series is sampled from the same statistical distribution along its entire trajectory) was assessed using the combined results of Augmented Dickey-Fuller (ADF) [45] and Kwiatkowski-Phillips-Schmidt-Shin (KPSS) tests (both TREND and LEVEL) [46]. The ADF test from the StatsModels package was used. An implementation of the KPSS test, written by Deniz Turan (http://denizstij.blogspot.co.uk/), was used (see Supplemental Materials for KPSS code).

For each time series, the top 50 most abundant OTUs were fit to a lag-3 sparse vector autoregressive model (i.e. sVAR(3), where ‘(3)’ indicates that 1–3 day lags were considered) using the sparsevar package in R v.3.2.8 (https://github.com/svazzole/sparsevar) (Fig 3) [30]. Elastic Net regularization was used for the sVAR fitting [47]. Thresholding was enforced so that very small coefficients were converted to zeros. Autocorrelation or cross-correlation structure was reduced in the sVAR(3) residuals, which allows us to more confidently apply standard statistics (i.e. methods that assume sample-to-sample independence) to the model residuals (Fig 3). Higher-order lags and rare taxa were not considered in order to minimize the number of estimated parameters. Granger causality coefficients were calculated for each non-zero sVAR coefficient [29], and significance was assessed using a chi-squared test (p < 0.05). Granger causality is based on linear time-lagged prediction: if time series A is predictive of the future values of time series B, it is said that A Granger causes B [48]. Granger causal interactions do not imply direct causality, as these associations may arise due to indirect influences.

OTU-OTU Spearman’s rho matrices were computed from the OTU matrices (i.e. relative abundances, rates, and rate residuals from the sVAR model) using Pandas [49]. Pairwise phylogenetic distances between OTU representative sequences were calculated using the dnadist function (default settings) in PHYLIP [50]. Spearman coefficients between OTUs were combined into phylogenetic distance bins, and the average coefficient for each bin was calculated.

The data files and python code used to carry out the analyses presented in this manuscript, along with notes showing commands run in R, are available on FigShare: https://figshare.com/articles/Time_Series_Meta-Analysis_Files/3581616

Database (Greengenes) OTUs accounted for 95–99%, 93–99%, 83–97%, and 83–96% of all sequences per time point in the F4, M3, DA, and DB time series, respectively. The proportion of non-database OTUs was quite stable over time. Furthermore, the 50 most abundant OTUs in each time series were all Greengenes OTUs. Non-database OTUs tended to be low-abundance taxa.

Stationarity implies that there is a restoring force on an OTU's abundance over time, so that it returns to a mean value after a perturbation (i.e. a steady-state population size, or ‘carrying capacity’). Indeed, we found a significant negative correlation between the change in OTU abundances between time t and time t+1 and the abundances of OTUs at time t (Fig 6). Thus, by converting abundance dynamics to rate dynamics, we can achieve stationarity across all abundant time series in the system and preserve correlation structure between OTUs, as long as we exclude non-stationary windows that contain large disturbances (e.g. food poisoning in the DB time series on day 150). Furthermore, the strong correlation between rates and OTU abundances at the prior time step indicates that much of the variance in these data is linear (Fig 6). The fact that these rate dynamics can be modeled as linear, stationary processes opens up a wide array of time series models to gut data sets.

Prior work has argued for the existence of discrete gut community configurations across humans, termed ‘enterotypes’, that may be associated with health and disease [12, 14]. However, longitudinal data has provided evidence that these enterotypes may arise from undersampling individuals through time. For example, the M3 time series is known to moved fluidly through all three putative enterotypes from Arumugam et al. (2010) during the course of a year [13], which suggests that gut communities vary along a continuum. We expanded upon this analysis using an improved Dirichlet multinomial mixture model (DMM) clustering method [14, 42], which assesses whether samples appear to be pulled from a common Dirichlet multinomial distribution. In general, clustering methodologies are plagued by over- and under-sampling issues. In a time series, samples that are taken close together in time are likely to be similar to one another (i.e. they are autocorrelated). If the community is sampled densely enough as it moves through state space, then packets of samples that happen to be temporally adjacent may be grouped into pseudo-clusters (i.e. over-sampling). On the other hand, if only a handful of samples are taken from an individual, then outlier points may give rise to pseudo-clusters because the state space was not sufficiently sampled (i.e. under-sampling). If there are no discrete states to be found, then the number of states should decay smoothly to 1 as the sampling sparcity is increased. However, if discrete states do exist, then the number of states should reach a plateau that is stable across a range of sampling densities.

Despite the clustering of individuals into unique states, we identified 956 OTUs that were present across all four individuals. These organisms tended to be found at similar median abundances across individuals (Fig 8). In addition, these shared OTUs made up 70–80% of the sequences in each data set (Table 2). Furthermore, a single OTU (from the genus Bacteroides; Greengenes ID 850870) was the most abundant taxon in M3, F4 and DB, and was the second most abundant organism in DA (Fig 6). Thus, despite the fact that most OTUs appear to be unique to an individual’s gut, there is a set of abundant core taxa that are present at similar abundances across people. It is unlikely that compositional effects are responsible for the existence of these carrying capacities, due to the fact that there is a wide-range in of abundances at which OTUs appear to persist (Fig 8). With similar carrying capacities not only within but also across individuals, these core OTUs likely occupy similar metabolic niches across humans.

*shared across 4 time series: 956

*shared across all data sets: 308

We employ an analytical approach based on continuous, multivariate, linear, autoregressive modeling tools developed for econometrics to pull apart two independent dynamic regimes in the human gut microbiome (Fig 3). Each regime, autoregressive and non-autoregressive, tells a unique story about the gut ecosystem.

Many sVAR coefficients showed significant Granger causal associations (i.e. the past abundances of one OTU predict the future abundances of another OTU; Fig 10; Chi-Squared test, p < 0.05). The M3 time series had the sparsest Granger network, with no significant relationships for 3-day lags. This lack of significant Granger relationships at 3-day lags may be due to the higher frequency of CRT blooms in that time series, which may have continually disrupted community recovery and obscured successional trends. A B. fragilis OTU had the largest number of connections in the M3 Granger network. B. fragilis, B. ovatus, and Enterobacteraceae OTUs had the largest numbers of connections in the F4 Granger network. In the DA and DB Granger networks, F. prausnitzii OTUs had the largest number of significant Granger interactions (Fig 10). Overall, Bacteroides, Faecalibacterium, and Enterobacteriaceae OTUs were prevalent in all the Granger networks (Fig 10). In each Granger network, there were several Granger-causal OTUs that influence multiple downstream responder OTUs, but there were only a few responder OTUs (e.g. B. fragilis, in the F4 time series) that integrate multiple upstream Granger signals. This pattern is consistent with cascading dynamics that result from perturbing a highly connected/central node in a network with an external shock [53]. In general, facultative aerobes (e.g. Enterobacteraceae OTUs) and aerotolerant taxa (e.g. Bacteroides) were more likely to Granger-cause obligate anaerobes (e.g. most Firmicutes OTUs) than the reverse (Fig 10). These intrinsic dynamics suggest a successional process that might follow a spike in luminal oxygen levels [52].

sVAR(3) residuals showed reduced autocovariance and could thus be more appropriately analyzed using standard statistical methods that assume independence. Closely related gut bacteria were generally positively correlated with one another, but this coherence decayed rapidly with phylogenetic distance (Fig 11). There was a significant anti-correlation between OTU-OTU phylogenetic distance and OTU-OTU correlations in abundances and abundance rates through time (i.e. highly related taxa tended to be positively correlated; Spearman’s p < 0.001). This phylogenetic coherence is conserved in the sVAR(3) residuals, but is completely absent in the sVAR(3) coefficients (Fig 11). Moreover, although we did not identify strong correlations between the set of dietary variables measured for the DB time series and the DB gut community, these dietary variables showed little-to-no autocorrelation structure (S3 Fig; and see Additional File A8 in David et al., 2014) [10]. Furthermore, we fit an sVAR(3) model to the original 97% OTUs from the DA time series paper and found that none of the OTUs that had previously been shown to correlate with dietary variables had any autoregressive signal (i.e. sVAR coefficients = 0; S1 File). We suggest that unmeasured dietary variables and host behavior/physiology are the non-autoregressive drivers responsible for the pronounced phylogenetic signal in OTU-OTU residual correlation structure (i.e. related taxa are positively correlated because they share a similar host/dietary niche, which fluctuates stochastically in time). In addition to phylogenetic coherence in the correlation structure within a gut time series, we find the same phylogenetic coherence in the correlations between OTU abundances across people from the HMP gut data set (S5 Fig). Thus, microbial phylogeny is strongly coupled to host niche in the human gut. In order to assess the generality of this relationship between phylogeny and correlation, we analyzed two time series from the English Channel and from Lake Mendota (marine and freshwater environments, respectively). We found the same pattern in these non-host associated environments, suggesting that niche filtering is a strong driver of dynamics across different ecosystems (S6 and S7 Figs).

Despite distinct differences in community composition across humans, the dynamics of the gut microbiota are stable and highly conserved. Dominant microbes in the gut appear to have fixed carrying capacities (i.e. their dynamics are stationary), which opens the door to many classical time series modeling approaches. Significant time-lagged interactions between OTUs often include opportunistic, facultative anaerobic organisms like Enterobacteraceae, and obligate anaerobes like F. prausnitzii [54, 55]. These autoregressive interactions appear to be due to succession and recovery of the gut community from CRT blooms, which may result from a disruption in the luminal redox balance [52]. The largest component of community variance is non-autoregressive and appears to be driven by non-autoregressive environmental forces, like pH [56] or fiber intake [10]. Unlike the autoregressive dynamics, these non-autoregressive dynamics carry a strong phylogenetic signal, indicative of niche filtering. Our results, based on a limited number of individuals, paint a coherent picture of the gut ecosystem and the major forces underlying its structure and stability, with two distinct dynamic regimes: one driven by external factors (e.g. diet) and the other by internal autoregressive processes (e.g. recovery following a disturbance). Moving forward, it will be important to collect more time series data, from both healthy and diseased individuals, to determine how general these dynamics are and whether or not they are observed in dysbiotic gut communities.


BEEM-Static: Accurate inference of ecological interactions from cross-sectional microbiome data

The structure and function of diverse microbial communities is underpinned by ecological interactions that remain uncharacterized. With rapid adoption of next-generation sequencing for studying microbiomes, data-driven inference of microbial interactions based on abundance correlations is widely used, but with the drawback that ecological interpretations may not be possible. Leveraging cross-sectional microbiome datasets for unravelling ecological structure in a scalable manner thus remains an open problem. We present an expectation-maximization algorithm (BEEM-Static) that can be applied to cross-sectional datasets to infer interaction networks based on an ecological model (generalized Lotka-Volterra). The method exhibits robustness to violations in model assumptions by using statistical filters to identify and remove corresponding samples. Benchmarking against 10 state-of-the-art correlation based methods showed that BEEM-Static can infer presence and directionality of ecological interactions even with relative abundance data (AUC-ROC>0.85), a task that other methods struggle with (AUC-ROC<0.63). In addition, BEEM-Static can tolerate a high fraction of samples (up to 40%) being not at steady state or coming from an alternate model. Applying BEEM-Static to a large public dataset of human gut microbiomes (n = 4,617) identified multiple stable equilibria that better reflect ecological enterotypes with distinct carrying capacities and interactions for key species.

BEEM-Static provides new opportunities for mining ecologically interpretable interactions and systems insights from the growing corpus of microbiome data.

Characterizing the ecological interactions among microbial members is an important step towards understanding the structure and function of diverse microbial communities. Widely used correlation based approaches for inferring interactions from cross-sectional microbiome sequencing data are not able to predict the directionality of interactions, and their results may not be interpretable. We developed an expectation-maximization algorithm (BEEM-Static) that can infer directed interaction networks from cross-sectional data based on an ecological model. Our benchmarking results showed that BEEM-Static inferred presence and directionality of interactions accurately, while correlation based methods had performance slightly better than random guesses. In addition, BEEM-Static was robust to various types of noises using statistical filters to identify and remove data points violating its assumptions. Applying BEEM-Static to a large public dataset of human gut microbiomes, we were able to identify multiple stable equilibria with distinct ecological properties.

Microbial communities represent complex systems that impact various aspects related to human health, e.g. agriculture [1], food processing [2], disease biology [3, 4] and healthcare [5]. Interactions between members of a microbial community determine emergent phenomena such as homeostasis in the ecosystem [6, 7] and overall function of the microbiome [8]. Ecological interactions can be grouped into six major categories including mutualism (positive-positive), competition (negative-negative), antagonism (positive-negative, further includes predation and parasitism), commensalism (positive-neutral), amensalism (negative-neutral) and neutralism (neutral-neutral) [9]. Correspondingly, ecological modeling of microbiomes taking into account such interactions is a key step towards understanding community function [10, 11], forecasting dynamics [12, 13] and rationally designing interventions that alter community structure and function [14].

We have previously introduced an expectation maximization (EM) algorithm which couples gLVM parameter and scaling factor estimation (BEEM), specifically for longitudinal microbiome data [23]. Here we transform this EM algorithm to work with cross-sectional data from communities that are at or near equilibrium (BEEM-Static; Fig 1). In benchmarking comparisons with simulated communities against 10 other methods that infer microbial interactions from cross-sectional data, we noted that while all other methods only improved slightly over random predictions (AUC-ROC<0.63), BEEM-Static exhibited high accuracy similar to estimation using true scaling values (AUC-ROC>0.88). Similar observations were made with synthetic communities based on all-pair co-culture experiments, where BEEM-Static accurately recapitulated nearly all known interactions and their directionality. Based on statistical filters to identify non-model and/or non-equilibrium samples in real and simulated datasets, we show that BEEM-Static can be robust to up to 40% of data violating these assumptions. Applying BEEM-Static to a large public collection of human gut microbiome profiles (n = 4,617) identified multiple stable equilibria that appear to better reflect ecological enterotypes with distinct carrying capacities and interactions for key species (e.g. Prevotella copri) compared to prior clustering based definitions [24]. BEEM-Static thus provides new opportunities for mining ecologically interpretable interactions and systems insights from the growing corpus of microbiome data in the public domain.

The gLVM model is a set of differential equations describing the instantaneous growth rate of each species (dxi(t)/dt) as a function of absolute cell densities (xi(t)) of the p species in a community:

Initialization and termination: BEEM-Static initializes biomass values based on normalization factors from cumulative sum scaling (CSS [25]), with a user defined scaling constant as the median of biomass values (kept constant through EM iterations). The EM process is then run until the maximum number of iterations specified (200 by default) or until convergence when the median of relative changes in biomass values is <10−3. Confidence values (Z-scores) for the final interaction matrix (non-zero off-diagonal entries) were calculated for each species i using forward stepwise regression (implemented in R package “selectiveInference”; version 1.2.5; Akaike information criterion as the stopping criterion).

BEEM-Static uses the following filters to identify and remove samples that violate modeling assumptions and could thus impact model inference:

This is done in the M-step for each iteration and samples with large median squared error, i.e. (ek−median(ek))/IQR(ek)>ϵ2 where IQR is the inter-quartile range and ϵ2 is a user defined parameter (default value of 3), are then removed for the next iteration’s M-step.

The shrinkage parameter λ in the sparse regression penalizes the number of parameters to avoid overfitting and is selected based on five-fold cross-validation in each iteration (selecting the value one standard error away from the best λ [26]). In the M-step of iteration T, a crude selection of
λc(T)
is made in BEEM-Static from a large range from 10−10 to 10−1, and then refined with a fine-grained sequence from
λc(T)/10
to
10λc(T)
.

Simulated gLVM data was generated based on previously described procedures [16, 19]. Specifically, to parameterize distributions for generating model parameters, MDSINE [19] was used to estimate the mean and standard deviations of growth rates and inter-/intra-species interaction parameters from the C. difficile infection experiment data provided with the software. Growth rates and intra-species interactions were sampled from normal distributions (forced to be positive and negative respectively to model logistic growth). The interaction network structure was generated by randomly adding edges from one species to another (with probability ranging from 0.1 to 0.5) and the magnitude of the interactions was sampled from a normal distribution (with 0 mean and standard deviation estimated from real data as noted above). Initial abundances of p (30) species were sampled from a uniform distribution (from 0.001 to the mean carrying capacity μi/βii of all the p species), with each species having a probability of π to be absent from a sample (π was estimated as the average rate of absence for the top p most prevalent species in all healthy gut microbiome profiles from the database curatedMetagenomicData [27]). A dataset with n samples was generated by numerically integrating the gLVM with the same parameters until equilibrium, starting with n different initial abundance profiles. The abundances of a random time point along the numerical integration (>20% away from the abundance at equilibrium for >50% of the species) was selected as a sample not at equilibrium. Poisson noise was added to the abundance of each species to simulate experimental variability.

Microbiome profiles for co-culture experiments were taken from a previous study [20] and the relative abundances were scaled using the corresponding biomass measurements (OD600). Six species pairs were randomly selected, and one of the three conditions were randomly picked for each pair in each sample: (1) only the first species was present, (2) only the second species was present and (3) both species were present. For the first two cases, a random timepoint (last 6 timepoints near the equilibrium) was taken from the growth curve (measured by OD600) of species present. For the last case, the scaled abundances of the two species near the steady state (randomly taken from the three replicates) were used. Abundances were re-scaled to relative abundances and the process repeated to generate a dataset with 500 samples. The interaction matrix reported in Venturelli et al [20] was treated as the ground truth (“M-PW1-PW2”).

We computed the median of relative errors to assess the accuracy of predicted parameters as:

The following correlation-based methods (Table 1) for inferring interactions from microbiome data were tested.

The -log(p-value) or edge stability were used to rank CCREPE and SPIEC-EASI correlations, respectively, while the absolute values of correlation coefficients were used for the other methods. AUC-ROC was calculated from the lower triangle of the inferred correlation matrix (an inference was considered correct if there was an interaction between the corresponding species regardless of the interaction direction). Sensitivity and precision of signs were calculated as described above, excluding positive-negative interactions as they cannot be differentiated from positive-positive and negative-negative interactions using correlation analysis.

Healthy gut microbiome profiles from the database curatedMetagenomicData were preprocessed and used as the standard dataset for learning gLVMs by removing (1) replicate samples, (2) timepoints other than the first timepoint in longitudinal studies, (3) samples under antibiotic treatment and (4) samples from infants. In addition, we included two validation datasets to evaluate different aspects of the model learned by BEEM-Static: (1) all samples from Raymond et al [36] to validate BEEM-Static’s estimated growth and (2) samples from healthy infants (only the first timepoint for each subject) with ages below 12 months to evaluate BEEM-Static’s biomass estimation. Both datasets were also used to validate BEEM-Static’s ability to filter out samples violating model assumptions. To make the number of parameters tractable with the number of data points available, we only kept core species that were present (relative abundance >0.1%) in more than 30% of samples and subsequently removed samples where none of the core species were found, resulting in 42 core species (S6 Fig) and 4,617 samples overall. BEEM-Static was applied with the “model filter” (ϵ2 = 0.9) to learn two models (1,995 and 1,145 samples for each model) in two iterations, in which samples violating the filter were removed (1,477 samples removed in total). BEEM-Static was then rerun without the filter on samples assigned to each model separately to re-learn parameters.

With BEEM-Static, in situ growth can be estimated as the deviation from equilibrium:

To evaluate if ecological interactions can be inferred from cross-sectional microbiome data (16S rRNA gene amplicon or whole metagenomic sequencing) we first began by conducting extensive benchmarks on complex simulated communities where the truth is known (using gLVMs, number of species = 30, equilibrium conditions; Methods). Consistent with prior reports [17, 18], we noted that all 10 state-of-the-art correlation-based methods provided performances that were only slightly better than random predictions in identifying true interactions, even while ignoring directionality (AUC-ROC<0.63; Figs
2A and S1). The ability to correct for compositionality of microbiome data (CCREPE, SparCC, CCLasso, REBACCA), or reduce false positives from transitive correlations (MInt, SPIEC-EASI, BAnOCC and gCoda), did not notably change performance compared to naïve correlation calculations (Pearson or Spearman) when inferring ecological interactions. In contrast, BEEM-Static was able to infer the interactions with notably higher sensitivity and specificity than all correlation-based methods (AUC-ROC = 0.88; Figs
2A and S1). Although BEEM-Static only used noisy relative abundances for gLVM inference, its performance matched that of a positive control that assumes noise-free biomass values to scale relative abundances to absolute abundances (Figs
2A and S1, BEEM-Static vs. true biomass), an assumption that is unlikely to be met in realistic settings [23].

We extended the evaluations to experimental data, using all-pair co-culture and isolate growth curves for 12 species [20] to create synthetic communities where the interaction network is known, albeit sparse (Fig 2C; Ground truth). Not surprisingly, recapitulating the structure of such a simple interaction network was not difficult for most correlation-based methods, with BAnOCC having the best performance overall (AUC-ROC = 0.9, S4 Fig). However, determining directionality of interactions was still a challenge, despite the simplicity of the network. For example, in the case of BAnOCC the commensalistic interaction between DP and FP was captured as a negative correlation, while the predatory interaction between BH and ER was captured as a positive correlation (Fig 2C; BAnOCC). BEEM-Static, on the other hand, was able to capture all interactions and their directionality correctly, except for one false positive (FP to DP) and one false negative (BT to EL) involving interactions with weak strength (Fig 2C; BEEM-Static). BEEM-Static’s utility in such datasets was consistently observed in comparison to correlation-based methods with AUC-ROC close to 1 (S4 Fig).

While the simulations in the previous section account for experimental errors, they assume that all samples come from equilibrium states, an unlikely situation for most real datasets. Relaxing this assumption, we noted that with as little as 5% non-equilibrium samples, AUC-ROC decreased by >10%, and with 15% non-equilibrium samples AUC-ROC performance degraded to match that of correlation-based methods (Naïve algorithm, Figs
3A and S5A; Methods). Incorporating a statistical filter in BEEM-Static that compares estimated species relative abundances at equilibrium with observed abundances (equilibrium filter; Methods) helped identify samples that were not at equilibrium with high sensitivity and specificity (S5A Fig). This in turn allowed BEEM-Static to be robust to having nearly half of the samples (45%) in the dataset being at a non-equilibrium state (performance reduction <5%; Figs
3A and S5A, BEEM-Static).

Finally, we employed real microbiome datasets to test BEEM-Static’s robustness where a subset of samples is known to violate modeling assumptions i.e. some subjects undergoing oral antibiotic treatment or samples from newborn infants, where the majority of samples are from adults who are not undergoing antibiotic treatment. BEEM-Static was able to identify such samples with high sensitivity (>80%) using its model filter (Fig 3C and
3D), and the filtered samples were significantly enriched for those from antibiotic-treated adults and infants (Fisher’s Exact test p-value<10−22).

To further assess BEEM-Static’s utility we evaluated the concordance of parameters learnt during the training process with orthogonal information for a large human gut microbiome dataset (N = 4,617; Methods). In particular, we noted that biomass estimates from BEEM-Static were significantly higher for adults versus newborn infants (~2×; Wilcoxon test p-value <10−15; Fig 4A), consistent with our understanding of a maturing gut microbiome [39, 40]. Additionally, we used deviations from equilibrium (dxi(t)/dt = 0) to estimate instantaneous growth (population increase or decrease) of each species in each sample (Methods), and assessed concordance with an in silico approach to estimate DNA replication rates [37]. Despite the fact that growth rates are also impacted by death rates, we observed that species predicted to grow based on BEEM-Static analysis were also found to have significantly higher DNA replication rates (GRiD values; Wilcoxon test p-value = 3×10−4; Fig 4B).

Using an iterative approach to train a new model on samples excluded from the first model, we observed that BEEM-Static classifies a majority of the samples to two models (1995 for model 1 and 1145 for model 2; S1 Table). Visualizing the expected microbial composition for each sample at equilibrium, we noted three distinct clusters in a principal component analysis plot (Fig 4C), where samples in clusters 1 and 2 largely correspond to profiles from models 1 and 2, respectively. Analysis of carrying capacities highlighted that the clusters were defined by Prevotella copri, which has higher carrying capacity in cluster 1 vs 2 and is absent in samples from cluster 3 (Fig 4D). Several other species were also found to have divergent carrying capacities in the two models, including Bifidobacterium adolescentis, Collinsella aerofaciens and Coprococcus comes (enriched in model 2), some of which have been shown to be associated with fiber intake [41, 42]. Overall the ecological models identified here have distinct sets of interactions (S1 Table) and do not appear to match earlier definitions of enterotypes [24] based on principal coordinate analysis and clustering (S7 Fig).

As microbiome research increasingly moves from descriptive studies to those that seek to provide a mechanistic understanding of microbial communities, the ability to infer microbial interactions from microbiome data is an important capability. In particular, the directionality and sign of interactions provide biologically interpretable information that is missed by correlation-based approaches. BEEM-Static provides an alternative avenue to infer this, with the caveats that it assumes a specific model (generalized Lotka-Volterra) for community dynamics and removes rare and low abundance species with limited number of samples in practice. In addition, as we show here, other values obtained from BEEM-Static models can have utility, including the strength of interactions, biomass estimates, deviation from equilibrium, and fit to model.

In addition to accounting for relative abundance estimates from microbiome data, the statistical filters employed by BEEM-Static make it robust to some of the violations in model assumptions that can be expected in real datasets. These features make BEEM-Static widely applicable, and also extends the use of ecological models with microbiome data. For instance, our analysis of large public microbiome datasets provides an alternate perspective to the discussion on microbial enterotypes [24] and universality of microbiome dynamics [43]. The ecological types observed here are characterized by distinct carrying capacities that might be a function of the environment (e.g. host factors or diet). Fiber rich diets are known to have a strong impact on the gut microbiome [42] and have been linked to some of the species with differential carrying capacities in our models [41]. We anticipate that the incorporation of such environmental factors into future models would be an exciting avenue to study their influence on microbial community structure in vivo. Finally, hybrid methods that learn models from both longitudinal and cross-sectional data represent another promising direction to explore for studying general and individual specific microbiome dynamics [23].

10 May 2021

To enhance the reproducibility of your results, we recommend that you deposit your laboratory protocols in protocols.io, where a protocol can be assigned its own identifier (DOI) such that it can be cited independently in the future. Additionally, PLOS ONE offers an option to publish peer-reviewed clinical study protocols. Read more information on sharing protocols at https://plos.org/protocols?utm_medium=editorial-email&utm_source=authorletters&utm_campaign=protocols

19 Jul 2021

11 Aug 2021

Reviewer #2: Yes: Leo Lahti

1 Sep 2021

PLOS Computational Biology | Carlyle House, Carlyle Road, Cambridge CB4 3DN | United Kingdom gro.solp@loibpmocsolp | Phone +44 (0) 1223-442824 | ploscompbiol.org | @PLOSCompBiol

